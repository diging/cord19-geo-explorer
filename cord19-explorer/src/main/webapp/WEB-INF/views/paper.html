<html layout:decorate="~{layouts/main}">
  <head>
    <title>CORD19 Geo Explorer</title>
  </head>
  <body>
   <div layout:fragment="content">
   <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"></script>
   <style>
	mark{
	    background: #f7ceff;
	    color: black;
	}
   </style>
   
   <h3>[[${publication.metadata.title}]] <span th:if="${publication.publishYear != ''}">([[${publication.publishYear}]])</span></h3>
   		
   	<div class="row">
   		<div class="col-sm-12">
   		by
   		<span th:each="author, iterstat : ${publication.metadata.authors}">
   		[[${author.first}]] [[${#strings.listJoin(author.middle,',')}]] [[${author.last}]]<span th:if="${not iterstat.last}">,</span>
   		</span>
   		</div>
   		
   		  <div style="padding-top: 20px;" class="col-sm-12">
   		  
   		  <div class="list-group">
	      <div th:each="section : ${sections}" th:remove="tag">
   		  <div th:if="${section.paragraphs != null}" th:remove="tag">
	      <span th:each="para : ${section.paragraphs}" th:remove="tag">
	      <span th:if="${para.locationMatches != null}" th:remove="tag">
	      
	      <a href="#" class="list-group-item" th:each="match : ${para.locationMatches}" th:classappend="${match.selectedArticle != null} ? '' : disabled">
		    <p class="list-group-item-text">
		    <b>[[${match.locationName}]]</b><br>
		    [[${match.selectedArticle?.title}]] <span th:if="${match.selectedArticle != null}" th:remove="tag">([[${match.selectedArticle?.coordinates}]])</span>
		    </p>
		  </a>
	      
		  </span>
	      </span>
	      </div>
	      </div>
		  </div>
	      
	      
	      <div th:each="section : ${sections}">
	      <h3 th:text="*{section.title != ''} ? *{section.title}: 'No Section title'"></h3>
	      <span th:each="para : ${section.paragraphs}">
	      <script th:inline="javascript" th:if="${not #lists.isEmpty(para.locationMatches)}">
	      $(function() {
	      	[# th:each="match : ${para.locationMatches}" ]
	      	[# th:if="${match != null}" ]
	      	$("#[(${#ids.next('para')})]").mark("[(${match.locationName})]", { "separateWordSearch": false})	
	      	[/]
	      	[/]
	      });
	      </script>
	      <p th:id="${#ids.seq('para')}" class="paraText">
	      [[${para.text}]]
	      </p>	 
	      	
	      </span>     	
   		  </div>
   		</div>
     
   </div>
  </body>
</html>